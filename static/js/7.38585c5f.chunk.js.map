{"version":3,"sources":["utils/sortData.ts","utils/hooks/useGetDataMeta.tsx","components/UI/ModalWithList.tsx","components/DataCalendar/DataCalendar.module.scss","components/UI/Calendar/index.tsx","components/DataCalendar/index.tsx"],"names":["sortData","key","direction","type","a","b","valueA","valueB","useGetDataMeta","tablename","useState","data","setData","useDictionaryContext","dictionary","setDictionary","useDataSelector","sourceData","isErrorData","isError","isLoadingData","isLoading","useMetadataSelector","metadata","isErrorMetadata","isLoadingMetadata","dispatch","useDispatch","mapDictionaryCb","useCallback","value","metadataProperty","find","property","id","split","map","v","text","join","includes","useEffect","dataGetAction","metadataGetAction","filter","forEach","validValues","Object","keys","length","d","mapValues","ModalWithList","title","dataSource","noDataText","avatar","width","Modal","info","content","renderItem","item","Item","Meta","description","index","module","exports","calendarModes","today","month","week","day","list","Calendar","dates","handleDayClick","handleEventClick","initialView","test","document","location","pathname","events","eventTimeFormat","hour","minute","plugins","dayGridPlugin","timeGridPlugin","listPlugin","interactionPlugin","dateClick","eventClick","locale","selectable","weekNumberCalculation","weekends","slotMinTime","headerToolbar","left","center","right","buttonText","moment","DataCalendar","mode","setDates","date","Date","time","getDetailedEventInfo","event","eventInfo","start","toISOString","className","classes","responsible","participants","format","DATE_FORMAT_FULLDATE","DATE_FORMAT_TIME","LoadingComponent","BulbOutlined","DATE_FORMAT_DATE","dateStr","sort","result","Title","level"],"mappings":"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","file":"static/js/7.38585c5f.chunk.js","sourcesContent":["import { TData } from \"../types/TData\";\r\nimport { TDataTypes } from \"../types/TDataTypes\";\r\n\r\nconst sortData =\r\n  (key: string, direction: \"ascend\" | \"descend\" = \"ascend\", type?: TDataTypes) =>\r\n  (a: TData, b: TData) =>\r\n  {\r\n    const valueA = type && type === 'number' ? +a[key] : a[key];\r\n    const valueB = type && type === 'number' ? +b[key] : b[key];\r\n\r\n    if (valueA < valueB) return direction === \"ascend\" ? -1 : 1;\r\n    if (valueA > valueB) return direction === \"ascend\" ? 1 : -1;\r\n    return 0;\r\n  }\r\n\r\nexport default sortData;\r\n","import { useCallback, useEffect, useState } from \"react\";\r\nimport { mapValues } from \"lodash\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useDataSelector } from \"../../storages/selectors/data\";\r\nimport { useMetadataSelector } from \"../../storages/selectors/metadata\";\r\nimport { dataGetAction } from \"../../storages/actions/data\";\r\nimport { metadataGetAction } from \"../../storages/actions/metadata\";\r\nimport { useDictionaryContext } from \"../../context/DictionaryContext\";\r\nimport { TData } from \"../../types/TData\";\r\n\r\nexport const useGetDataMeta = (tablename: string) => {\r\n  const [ data, setData ] = useState<TData[]>([]);\r\n  const { dictionary, setDictionary } = useDictionaryContext();\r\n\r\n  const { data: sourceData, isError: isErrorData, isLoading: isLoadingData } = useDataSelector();\r\n  const { data: metadata, isError: isErrorMetadata, isLoading: isLoadingMetadata } = useMetadataSelector();\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  const mapDictionaryCb = useCallback((value: string, key: string) => {\r\n    const metadataProperty = metadata?.find((property) => property.id === key);\r\n    if (metadataProperty && metadataProperty.type === 'multi-select' && dictionary[key]){\r\n      return value.split(',').map((v) => dictionary[key][v].text).join(', ')\r\n    } else if (metadataProperty && ['select', 'checkbox'].includes(metadataProperty.type)  && dictionary[key] && dictionary[key][value]) {\r\n      return dictionary[key][value].text\r\n    }\r\n    return value;\r\n  }, [metadata, dictionary])\r\n\r\n  useEffect(() => {\r\n    dispatch(dataGetAction(tablename));\r\n    dispatch(metadataGetAction(tablename));\r\n  }, [tablename, dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (metadata) {\r\n      metadata\r\n        .filter((property) => ['select', 'multi-select', 'checkbox'].includes(property.type))\r\n        .forEach((property) => setDictionary(property.id, property.validValues))\r\n    }\r\n  }, [metadata, setDictionary]);\r\n\r\n  useEffect(() => {\r\n    if (sourceData && metadata && Object.keys(dictionary).length) {\r\n      setData(() => sourceData.map((d) => mapValues(d, mapDictionaryCb)));\r\n    }\r\n  }, [sourceData, metadata, dictionary, mapDictionaryCb]);\r\n\r\n  return {\r\n    data, isErrorData, isLoadingData,\r\n    metadata, isErrorMetadata, isLoadingMetadata\r\n  }\r\n}\r\n","import { List, Modal } from \"antd\";\r\n\r\ninterface IModalWithList {\r\n  title: string;\r\n  dataSource?: {title: string, description: string}[],\r\n  noDataText?: string,\r\n  avatar?: React.ReactNode,\r\n  width?: number,\r\n};\r\n\r\nconst ModalWithList = ({\r\n  title,\r\n  dataSource = [],\r\n  noDataText = 'Нет данных',\r\n  avatar = null,\r\n  width = 600,\r\n}: IModalWithList) => {\r\n  if (dataSource && dataSource.length) {\r\n    Modal.info({\r\n      title,\r\n      content: (\r\n        <List\r\n          dataSource={dataSource}\r\n          renderItem={(item) => (\r\n            <List.Item>\r\n              <List.Item.Meta\r\n                avatar={avatar}\r\n                title={item.title}\r\n                description={item.description.split('\\n').map((text, index) => <div key={index}>{text}</div>)}\r\n              />\r\n            </List.Item>\r\n          )}\r\n        />\r\n      ),\r\n      width: `${width}px`\r\n    });\r\n  } else {\r\n    Modal.info({\r\n      title,\r\n      content: noDataText,\r\n      width: `${width}px`\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport default ModalWithList;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"detailed-event-info-row\":\"DataCalendar_detailed-event-info-row__3iXF4\",\"detailed-event-info-headcol\":\"DataCalendar_detailed-event-info-headcol__1kx2O\",\"detailed-event-info-col\":\"DataCalendar_detailed-event-info-col__eI6lM\"};","import FullCalendar from '@fullcalendar/react';\r\nimport dayGridPlugin from '@fullcalendar/daygrid';\r\nimport timeGridPlugin from '@fullcalendar/timegrid';\r\nimport listPlugin from '@fullcalendar/list';\r\nimport interactionPlugin from '@fullcalendar/interaction';\r\nimport './Calendar.css';\r\n\r\nconst calendarModes = { today: 'Сегодня', month: 'Месяц', week: 'Неделя', day: 'День', list: 'Список' };\r\n\r\ninterface ICalendar {\r\n  dates: any[],\r\n  handleDayClick: (event: any) => void,\r\n  handleEventClick: (event: any) => void\r\n};\r\n\r\nexport const Calendar: React.FC<ICalendar> = ({dates, handleDayClick, handleEventClick}) => {\r\n  let initialView = 'dayGridMonth';\r\n  if (/\\/calendar\\/list/.test(document.location.pathname)) {\r\n    initialView = 'listWeek';\r\n  }\r\n\r\n  return (\r\n    <FullCalendar\r\n      events={dates}\r\n      eventTimeFormat={{ hour: '2-digit', minute: '2-digit' }}\r\n      plugins={[dayGridPlugin, timeGridPlugin, listPlugin, interactionPlugin]}\r\n      initialView={initialView}\r\n      dateClick={handleDayClick}\r\n      eventClick={handleEventClick}\r\n      locale=\"ru\"\r\n      selectable\r\n      weekNumberCalculation=\"ISO\"\r\n      weekends={false}\r\n      slotMinTime=\"08:00:00\"\r\n      headerToolbar={{\r\n        left: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek',\r\n        center: 'title',\r\n        right: 'today prev,next',\r\n      }}\r\n      buttonText={calendarModes}\r\n    />\r\n  )\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport moment from 'moment';\r\nimport 'moment/locale/ru';\r\nimport { Col, Modal, Row, Typography } from 'antd';\r\nimport { BulbOutlined } from '@ant-design/icons';\r\nimport { Calendar } from '../UI/Calendar';\r\nimport LoadingComponent from '../UI/LoadingComponent';\r\nimport { useGetDataMeta } from '../../utils/hooks/useGetDataMeta';\r\nimport sortData from '../../utils/sortData';\r\nimport { TData } from '../../types/TData';\r\nimport { DATE_FORMAT_DATE, DATE_FORMAT_FULLDATE, DATE_FORMAT_TIME } from '../../constants/constants';\r\nimport classes from './DataCalendar.module.scss';\r\nimport ModalWithList from '../UI/ModalWithList';\r\n\r\nmoment.locale('ru');\r\n\r\ninterface IDataCalendar {\r\n  mode: string,\r\n}\r\n\r\nconst DataCalendar: React.FC<IDataCalendar> = ({ mode }) => {\r\n  const [dates, setDates] = useState<TData[]>([]);\r\n  const {\r\n    data, isErrorData, isLoadingData,\r\n    isLoadingMetadata, isErrorMetadata\r\n  } = useGetDataMeta(mode);\r\n\r\n  useEffect(() => {\r\n    if (data && data.length) {\r\n      setDates(data.map((d) => ({\r\n        ...d,\r\n        date: new Date(`${d.date} ${d.time}`),\r\n      })))\r\n    }\r\n  }, [data]);\r\n\r\n  const getDayEventsInfo = (date: any) => {\r\n    return dates\r\n      .filter((event) => moment(event.date).format(DATE_FORMAT_DATE) === date.dateStr)\r\n      .sort(sortData('time', 'ascend'))\r\n      .map((event) => ({\r\n        title: moment(event.date).format(DATE_FORMAT_TIME),\r\n        description: event.result,\r\n      }))\r\n    }\r\n\r\n  const handleDayClick = (day: any) => {\r\n    ModalWithList({\r\n      title: 'Совещания за день',\r\n      avatar: <BulbOutlined />,\r\n      dataSource: getDayEventsInfo(day),\r\n      noDataText: 'Нет назначенных совещаний',\r\n    });\r\n  };\r\n\r\n  const getDetailedEventInfo = (event: any) => {\r\n    const eventInfo = dates.find(\r\n      (d) =>\r\n        moment(event.event.start).toISOString() === moment(d.date).toISOString() &&\r\n        d.title === event.event.title\r\n    );\r\n\r\n    return (\r\n      eventInfo ? (\r\n        <>\r\n          <Row className={classes['detailed-event-info-row']}>\r\n            <Col className={classes['detailed-event-info-headcol']}>Тема</Col>\r\n            <Col className={classes['detailed-event-info-col']}>{eventInfo.title}</Col>\r\n          </Row>\r\n          <Row className={classes['detailed-event-info-row']}>\r\n            <Col className={classes['detailed-event-info-headcol']}>Ответственный</Col>\r\n            <Col className={classes['detailed-event-info-col']}>{eventInfo.responsible}</Col>\r\n          </Row>\r\n          <Row className={classes['detailed-event-info-row']}>\r\n            <Col className={classes['detailed-event-info-headcol']}>Участники</Col>\r\n            <Col className={classes['detailed-event-info-col']}>{eventInfo.participants}</Col>\r\n          </Row>\r\n          <Row className={classes['detailed-event-info-row']}>\r\n            <Col className={classes['detailed-event-info-headcol']}>Дата</Col>\r\n            <Col className={classes['detailed-event-info-col']}>\r\n              {moment(eventInfo.date).format(DATE_FORMAT_FULLDATE)}\r\n            </Col>\r\n          </Row>\r\n          <Row className={classes['detailed-event-info-row']}>\r\n            <Col className={classes['detailed-event-info-headcol']}>Время</Col>\r\n            <Col className={classes['detailed-event-info-col']}>\r\n              {moment(eventInfo.date).format(DATE_FORMAT_TIME)}\r\n            </Col>\r\n          </Row>\r\n        </>\r\n      ) : 'Нет назначенных совещаний'\r\n    )\r\n  };\r\n\r\n  const handleEventClick = (event: any) => {\r\n    Modal.info({\r\n      title: 'Совещаниe',\r\n      content: getDetailedEventInfo(event),\r\n      width: '600px'\r\n    });\r\n  };\r\n\r\n  return (\r\n    isLoadingData || isLoadingMetadata ? (\r\n      <div className={classes.center}>\r\n        <LoadingComponent />\r\n      </div>\r\n    ) : (\r\n      (isErrorData || isErrorMetadata) && !dates ? (\r\n        <div className={classes.center}>\r\n          <Typography.Title level={3}>Ошибка получения данных</Typography.Title>\r\n        </div>\r\n      ) : (\r\n        dates &&\r\n          <Calendar\r\n            dates={dates}\r\n            handleEventClick={handleEventClick}\r\n            handleDayClick={handleDayClick}\r\n          />\r\n      )\r\n    )\r\n  )\r\n}\r\n\r\nexport default DataCalendar;\r\n"],"sourceRoot":""}